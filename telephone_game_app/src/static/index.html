<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telephone Game Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .description {
            background-color: #e8f4f8;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .controls {
            text-align: center;
            margin-bottom: 30px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .loading {
            text-align: center;
            margin: 20px 0;
            color: #666;
        }
        .results {
            margin-top: 30px;
        }
        .plot-container {
            text-align: center;
            margin: 20px 0;
        }
        .plot-container img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        .analysis {
            background-color: #fff3cd;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .analysis h3 {
            margin-top: 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¯ Telephone Game Simulation</h1>
        
        <div class="description">
            <h3>About the Simulation</h3>
            <p>This simulation models the classic "Telephone Game" with 1,000 agents in a chain. Each agent receives a 6-character string, may alter it based on their trust in others, and passes it to the next agent. The simulation tracks how trust evolves over time as agents observe the final output and adjust their behavior accordingly.</p>
            
            <h4>Key Features:</h4>
            <ul>
                <li><strong>Trust Dynamics:</strong> Agents lose trust in others who appear to cause greater deviations</li>
                <li><strong>Adaptive Behavior:</strong> Agents adjust their likelihood of altering messages based on trust levels</li>
                <li><strong>Memory System:</strong> Each agent remembers past interactions and outcomes</li>
                <li><strong>Convergence Analysis:</strong> Observe whether trust increases or decreases over time</li>
            </ul>
        </div>
        
        <div class="controls">
            <button id="runSimulation" onclick="runSimulation()">Run Simulation</button>
        </div>
        
        <div id="loading" class="loading" style="display: none;">
            Running simulation... This may take a few moments.
        </div>
        
        <div id="results" class="results" style="display: none;">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="numAgents">-</div>
                    <div class="stat-label">Agents</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="numTimesteps">-</div>
                    <div class="stat-label">Timesteps</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="initialTrust">-</div>
                    <div class="stat-label">Initial Trust</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="finalTrust">-</div>
                    <div class="stat-label">Final Trust</div>
                </div>
            </div>
            
            <div class="plot-container">
                <img id="trustPlot" src="" alt="Trust Score Plot">
            </div>
            
            <div class="analysis">
                <h3>Analysis</h3>
                <p id="analysisText">-</p>
            </div>
        </div>
    </div>

    <script>
        async function runSimulation() {
            const button = document.getElementById('runSimulation');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            button.disabled = true;
            loading.style.display = 'block';
            results.style.display = 'none';
            
            try {
                const response = await fetch('/api/run_simulation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Simulation failed');
                }
                
                const data = await response.json();
                
                // Update stats
                document.getElementById('numAgents').textContent = data.num_agents.toLocaleString();
                document.getElementById('numTimesteps').textContent = data.num_timesteps;
                document.getElementById('initialTrust').textContent = data.trust_scores[0].toFixed(3);
                document.getElementById('finalTrust').textContent = data.trust_scores[data.trust_scores.length - 1].toFixed(3);
                
                // Update plot
                document.getElementById('trustPlot').src = 'data:image/png;base64,' + data.plot;
                
                // Generate analysis
                const initialTrust = data.trust_scores[0];
                const finalTrust = data.trust_scores[data.trust_scores.length - 1];
                const trustChange = finalTrust - initialTrust;
                
                let analysisText = '';
                if (trustChange < -0.1) {
                    analysisText = `Trust declined significantly from ${initialTrust.toFixed(3)} to ${finalTrust.toFixed(3)}. This suggests that agents became increasingly distrustful of each other as they observed greater deviations between input and output strings. The telephone game dynamics led to a breakdown in trust.`;
                } else if (trustChange > 0.1) {
                    analysisText = `Trust increased from ${initialTrust.toFixed(3)} to ${finalTrust.toFixed(3)}. This indicates that agents found each other to be relatively reliable, leading to increased cooperation and trust over time.`;
                } else {
                    analysisText = `Trust remained relatively stable, changing from ${initialTrust.toFixed(3)} to ${finalTrust.toFixed(3)}. This suggests the system reached an equilibrium where trust levels stabilized.`;
                }
                
                document.getElementById('analysisText').textContent = analysisText;
                
                results.style.display = 'block';
                
            } catch (error) {
                alert('Error running simulation: ' + error.message);
            } finally {
                button.disabled = false;
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>

